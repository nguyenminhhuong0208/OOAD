{"ast":null,"code":"/*global module*/\nvar Buffer = require('safe-buffer').Buffer;\nvar DataStream = require('./data-stream');\nvar jwa = require('jwa');\nvar Stream = require('stream');\nvar toString = require('./tostring');\nvar util = require('util');\nfunction base64url(string, encoding) {\n  return Buffer.from(string, encoding).toString('base64').replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n}\nfunction jwsSecuredInput(header, payload, encoding) {\n  encoding = encoding || 'utf8';\n  var encodedHeader = base64url(toString(header), 'binary');\n  var encodedPayload = base64url(toString(payload), encoding);\n  return util.format('%s.%s', encodedHeader, encodedPayload);\n}\nfunction jwsSign(opts) {\n  var header = opts.header;\n  var payload = opts.payload;\n  var secretOrKey = opts.secret || opts.privateKey;\n  var encoding = opts.encoding;\n  var algo = jwa(header.alg);\n  var securedInput = jwsSecuredInput(header, payload, encoding);\n  var signature = algo.sign(securedInput, secretOrKey);\n  return util.format('%s.%s', securedInput, signature);\n}\nfunction SignStream(opts) {\n  var secret = opts.secret || opts.privateKey || opts.key;\n  var secretStream = new DataStream(secret);\n  this.readable = true;\n  this.header = opts.header;\n  this.encoding = opts.encoding;\n  this.secret = this.privateKey = this.key = secretStream;\n  this.payload = new DataStream(opts.payload);\n  this.secret.once('close', function () {\n    if (!this.payload.writable && this.readable) this.sign();\n  }.bind(this));\n  this.payload.once('close', function () {\n    if (!this.secret.writable && this.readable) this.sign();\n  }.bind(this));\n}\nutil.inherits(SignStream, Stream);\nSignStream.prototype.sign = function sign() {\n  try {\n    var signature = jwsSign({\n      header: this.header,\n      payload: this.payload.buffer,\n      secret: this.secret.buffer,\n      encoding: this.encoding\n    });\n    this.emit('done', signature);\n    this.emit('data', signature);\n    this.emit('end');\n    this.readable = false;\n    return signature;\n  } catch (e) {\n    this.readable = false;\n    this.emit('error', e);\n    this.emit('close');\n  }\n};\nSignStream.sign = jwsSign;\nmodule.exports = SignStream;","map":{"version":3,"names":["Buffer","require","DataStream","jwa","Stream","toString","util","base64url","string","encoding","from","replace","jwsSecuredInput","header","payload","encodedHeader","encodedPayload","format","jwsSign","opts","secretOrKey","secret","privateKey","algo","alg","securedInput","signature","sign","SignStream","key","secretStream","readable","once","writable","bind","inherits","prototype","buffer","emit","e","module","exports"],"sources":["C:/Users/Admin/Favorites/OOAD/fontend/node_modules/jws/lib/sign-stream.js"],"sourcesContent":["/*global module*/\nvar Buffer = require('safe-buffer').Buffer;\nvar DataStream = require('./data-stream');\nvar jwa = require('jwa');\nvar Stream = require('stream');\nvar toString = require('./tostring');\nvar util = require('util');\n\nfunction base64url(string, encoding) {\n  return Buffer\n    .from(string, encoding)\n    .toString('base64')\n    .replace(/=/g, '')\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_');\n}\n\nfunction jwsSecuredInput(header, payload, encoding) {\n  encoding = encoding || 'utf8';\n  var encodedHeader = base64url(toString(header), 'binary');\n  var encodedPayload = base64url(toString(payload), encoding);\n  return util.format('%s.%s', encodedHeader, encodedPayload);\n}\n\nfunction jwsSign(opts) {\n  var header = opts.header;\n  var payload = opts.payload;\n  var secretOrKey = opts.secret || opts.privateKey;\n  var encoding = opts.encoding;\n  var algo = jwa(header.alg);\n  var securedInput = jwsSecuredInput(header, payload, encoding);\n  var signature = algo.sign(securedInput, secretOrKey);\n  return util.format('%s.%s', securedInput, signature);\n}\n\nfunction SignStream(opts) {\n  var secret = opts.secret||opts.privateKey||opts.key;\n  var secretStream = new DataStream(secret);\n  this.readable = true;\n  this.header = opts.header;\n  this.encoding = opts.encoding;\n  this.secret = this.privateKey = this.key = secretStream;\n  this.payload = new DataStream(opts.payload);\n  this.secret.once('close', function () {\n    if (!this.payload.writable && this.readable)\n      this.sign();\n  }.bind(this));\n\n  this.payload.once('close', function () {\n    if (!this.secret.writable && this.readable)\n      this.sign();\n  }.bind(this));\n}\nutil.inherits(SignStream, Stream);\n\nSignStream.prototype.sign = function sign() {\n  try {\n    var signature = jwsSign({\n      header: this.header,\n      payload: this.payload.buffer,\n      secret: this.secret.buffer,\n      encoding: this.encoding\n    });\n    this.emit('done', signature);\n    this.emit('data', signature);\n    this.emit('end');\n    this.readable = false;\n    return signature;\n  } catch (e) {\n    this.readable = false;\n    this.emit('error', e);\n    this.emit('close');\n  }\n};\n\nSignStream.sign = jwsSign;\n\nmodule.exports = SignStream;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}